<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šè¯¦æƒ… | AeroScope Insight</title>
    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥ ECharts ç”¨äºç»˜åˆ¶èèµ„å›¾è¡¨ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* =========================================
           1. Header & Footer æ ·å¼ (ä¸¥æ ¼å¯¹é½ Index)
           ========================================= */
        
        /* æœç´¢æ¡†ç»„ä»¶ */
        .search-component { position: relative; margin-right: 15px; }
        .search-box { display: flex; align-items: center; border: 1px solid #cbd5e1; border-radius: 20px; background: white; padding: 5px 12px; transition: 0.3s; }
        .search-box:focus-within { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .search-icon { font-size: 1rem; color: #64748b; margin-right: 8px; }
        .search-input { border: none; outline: none; font-size: 0.9rem; width: 160px; color: #1e293b; }
        
        /* æœç´¢ä¸‹æ‹‰ */
        #search-dropdown { position: absolute; top: 45px; right: 0; width: 280px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 2000; display: none; max-height: 400px; overflow-y: auto; }
        .search-result-item { display: block; padding: 12px; border-bottom: 1px solid #f1f5f9; text-decoration: none; color: #1e293b; transition: 0.2s; }
        .search-result-item:hover { background: #f8fafc; }

        /* é¡µè„š Grid */
        .footer-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 40px; padding-bottom: 40px; }
        .footer-col h4 { color: white; margin-bottom: 20px; font-size: 1rem; font-weight: 600; }
        .footer-col ul li { margin-bottom: 12px; }
        .footer-col a { color: #94a3b8; font-size: 0.9rem; transition: color 0.2s; }
        .footer-col a:hover { color: #3b82f6; }
        .social-icons { display: flex; gap: 15px; margin-top: 20px; }
        .social-btn { width: 36px; height: 36px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; transition: 0.3s; }
        .social-btn:hover { background: #3b82f6; transform: translateY(-2px); }

        @media (max-width: 768px) {
            .footer-grid { grid-template-columns: 1fr; text-align: center; }
            .social-icons { justify-content: center; }
            .search-component { display: none; }
        }

        /* =========================================
           2. ä¼ä¸šè¯¦æƒ…é¡µä¸“ç”¨é«˜çº§æ ·å¼ (ä¿æŒè‹¹æœé£)
           ========================================= */
        body { background-color: #f8fafc; color: #1e293b; }
        
        /* é¡¶éƒ¨ Hero å¡ç‰‡ */
        .company-hero { 
            background: white; border-bottom: 1px solid #e2e8f0; padding: 40px 0; margin-bottom: 30px;
        }
        .company-header-flex { display: flex; align-items: flex-start; gap: 30px; }
        .company-logo-lg { 
            width: 110px; height: 110px; border-radius: 16px; 
            background: #fff; display: flex; align-items: center; justify-content: center; 
            font-size: 2.5rem; font-weight: 800; color: #cbd5e1; overflow: hidden;
            border: 1px solid #e2e8f0; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
        }
        .company-info-main { flex: 1; }
        .company-name { font-size: 2.2rem; font-weight: 800; color: #0f172a; line-height: 1.1; margin: 0; }
        .ticker-badge { 
            display: inline-block; background: #f1f5f9; color: #475569; 
            padding: 4px 10px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; 
            border: 1px solid #cbd5e1; vertical-align: middle; margin-left: 10px;
        }
        .company-subtitle { margin-top: 8px; color: #64748b; font-size: 1.05rem; }
        
        .meta-badges { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .meta-badge { display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: #475569; background: #f8fafc; padding: 6px 12px; border-radius: 20px; border: 1px solid #e2e8f0; }
        
        /* å¸ƒå±€ç½‘æ ¼ */
        .detail-grid { display: grid; grid-template-columns: 2.2fr 1fr; gap: 30px; margin-bottom: 60px; }
        
        /* é€šç”¨å¡ç‰‡ */
        .info-card { 
            background: white; border-radius: 16px; border: 1px solid #e2e8f0; 
            padding: 28px; margin-bottom: 25px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02);
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #f1f5f9; }
        .card-title { font-size: 1.2rem; font-weight: 700; color: #0f172a; display: flex; align-items: center; gap: 8px; }
        .card-title::before { content: ''; width: 4px; height: 18px; background: #3b82f6; border-radius: 2px; display: block; }
        
        /* æ ‡ç­¾äº‘ */
        .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag-pill { background: #eff6ff; color: #3b82f6; padding: 5px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }

        /* èèµ„è¡¨æ ¼ */
        .funding-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .funding-table th { text-align: left; color: #64748b; font-weight: 500; padding: 12px 8px; border-bottom: 1px solid #e2e8f0; font-size: 0.85rem; }
        .funding-table td { padding: 16px 8px; border-bottom: 1px dashed #f1f5f9; color: #334155; vertical-align: top; }
        .funding-table tr:last-child td { border-bottom: none; }
        .round-tag { background: #ecfdf5; color: #059669; padding: 2px 8px; border-radius: 4px; font-weight: 600; font-size: 0.8rem; }
        .investor-list { font-size: 0.85rem; color: #64748b; line-height: 1.5; }

        /* =========================================
           3. ä¸“åˆ©åˆ—è¡¨æ ·å¼ (ä¼˜åŒ–ç‰ˆï¼šå•è¡Œ + åˆ†é¡µ)
           ========================================= */
        .patent-item-link {
            text-decoration: none;
            color: inherit;
            display: block;
            transition: background 0.2s;
            border-bottom: 1px dashed #f1f5f9;
        }
        .patent-item-link:last-child {
            border-bottom: none;
        }
        .patent-item-link:hover {
            background-color: #f8fafc;
        }

        .patent-item { 
            display: flex; 
            align-items: center; /* å‚ç›´å±…ä¸­ */
            padding: 12px 10px; 
            gap: 12px;
            height: 48px; /* å›ºå®šé«˜åº¦ç¡®ä¿æ•´é½ */
            box-sizing: border-box;
        }

        /* ä¸“åˆ©å›¾æ ‡ */
        .patent-icon { 
            width: 26px; height: 26px; 
            background: #f5f3ff; color: #7c3aed; 
            border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; 
            flex-shrink: 0; font-weight: bold; font-size: 0.7rem;
        }

        /* æ ¸å¿ƒå†…å®¹å®¹å™¨ï¼šFlex å¸ƒå±€å®ç°å·¦æ ‡é¢˜å³ä¿¡æ¯ */
        .patent-content-row {
            flex: 1;
            min-width: 0; /* å…³é”®ï¼šå…è®¸å­å…ƒç´ å‹ç¼© */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ ‡é¢˜ï¼šå æ®å‰©ä½™ç©ºé—´ï¼Œå•è¡Œçœç•¥ */
        .patent-title { 
            margin: 0; 
            font-size: 0.95rem; 
            color: #334155; 
            font-weight: 500; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            margin-right: 15px;
        }

        /* å…ƒæ•°æ®ï¼šé å³ï¼Œä¸æ¢è¡Œ */
        .patent-meta-inline { 
            font-size: 0.8rem; 
            color: #94a3b8; 
            display: flex; 
            align-items: center; 
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
            gap: 8px;
        }

        /* çŠ¶æ€æ ‡ç­¾åœ†ç‚¹ */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }
        
        /* æ ‡ç­¾å°å¾½ç«  */
        .type-badge { background:#f1f5f9; padding:2px 6px; border-radius:4px; font-size:0.75rem; color:#64748b; }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding-top: 15px;
            margin-top: 10px;
            border-top: 1px solid #f1f5f9;
        }
        .page-btn {
            background: white; border: 1px solid #cbd5e1;
            color: #64748b; padding: 4px 12px; border-radius: 4px;
            font-size: 0.8rem; cursor: pointer; transition: 0.2s;
        }
        .page-btn:hover:not(:disabled) { border-color: #3b82f6; color: #3b82f6; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; background: #f8fafc; }

        /* äº§å“å¡ç‰‡ */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .product-mini-card { border: 1px solid #e2e8f0; border-radius: 10px; overflow: hidden; transition: 0.2s; text-decoration: none; color: inherit; display: block; }
        .product-mini-card:hover { border-color: #3b82f6; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .pm-img { width: 100%; height: 120px; background: #cbd5e1; object-fit: cover; }
        .pm-content { padding: 12px; }
        .pm-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 5px; color: #0f172a; }
        .pm-badge { font-size: 0.7rem; background: #f1f5f9; padding: 2px 6px; border-radius: 4px; color: #64748b; }

        /* ä¾§è¾¹æ æ•°æ® */
        .kv-group { margin-bottom: 25px; }
        .kv-label { color: #64748b; font-size: 0.85rem; margin-bottom: 4px; display: block; }
        .kv-value { font-size: 1.1rem; font-weight: 600; color: #0f172a; }
        .kv-value-lg { font-size: 1.5rem; color: #3b82f6; font-weight: 800; }

        /* ç«å“ */
        .comp-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f1f5f9; text-decoration: none; }
        .comp-item:hover .comp-name { color: #3b82f6; }
        .comp-logo { width: 32px; height: 32px; border-radius: 6px; background: #f1f5f9; object-fit: cover; }
        .comp-name { font-size: 0.95rem; font-weight: 600; color: #334155; }
        .comp-meta { font-size: 0.75rem; color: #94a3b8; margin-left: auto; }

        @media (max-width: 768px) {
            .detail-grid { grid-template-columns: 1fr; }
            .company-header-flex { flex-direction: column; align-items: center; text-align: center; }
            .meta-badges { justify-content: center; }
            /* ç§»åŠ¨ç«¯è°ƒæ•´ï¼šéšè—éƒ¨åˆ†å…ƒæ•°æ®ä»¥é˜²æ‹¥æŒ¤ */
            .patent-meta-inline span:nth-child(2) { display: none; } /* éšè—æ—¥æœŸ */
        }
    </style>
</head>
<body>

    <!-- 1. Header (ä¸¥æ ¼å¤ç”¨ Index æ ·å¼) -->
    <header>
        <div class="standard-container">
            <div class="nav-inner">
                <a href="index.html" class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    AeroScope<span>Insight</span>
                </a>
                <button class="mobile-menu-btn" onclick="toggleMenu()">â˜°</button>
                <nav class="nav-links" id="navMenu">
                    <a href="index.html">é¦–é¡µ</a>
                    <a href="news.html">èµ„è®¯å¿«æŠ¥</a>
                    <a href="policies.html">æ”¿ç­–æ³•è§„</a>
                    <a href="tech.html">æŠ€æœ¯å‰æ²¿</a>
                    <a href="companies.html" class="active">è¡Œä¸šå›¾è°±</a>
                    <a href="forum.html">è®ºå›äº¤æµ</a>
                </nav>
                <div class="header-actions">
                    <div class="search-component">
                        <div class="search-box">
                            <span class="search-icon">ğŸ”</span>
                            <input type="text" class="search-input" placeholder="æœå…¬å¸ã€æ”¿ç­–..." id="global-search" onkeyup="performGlobalSearch(this.value)">
                        </div>
                        <div id="search-dropdown"></div>
                    </div>
                    <button class="btn btn-primary" id="auth-btn" onclick="location.href='login.html'">ç™»å½•/æ³¨å†Œ</button>
                </div>
            </div>
        </div>
    </header>

    <!-- 2. ä¼ä¸š Hero åŒºåŸŸ -->
    <div class="company-hero">
        <div class="standard-container">
            <div class="back-nav" style="margin-bottom: 25px;">
                <a href="companies.html" style="color:#64748b; font-size:0.9rem; text-decoration:none; display:inline-flex; align-items:center; gap:5px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    è¿”å›ä¼ä¸šåº“
                </a>
            </div>
            
            <div class="company-header-flex" id="company-header">
                <div class="company-logo-lg">...</div>
                <div class="company-info-main">
                    <div>
                        <h1 class="company-name" style="display:inline;">æ­£åœ¨åŠ è½½...</h1>
                        <span class="ticker-badge" id="header-ticker" style="display:none;"></span>
                    </div>
                    <div class="company-subtitle" id="header-subtitle">...</div>
                    
                    <div class="meta-badges">
                        <div class="meta-badge">ğŸ“ <span id="header-loc">--</span></div>
                        <div class="meta-badge">ğŸ“… æˆç«‹äº <span id="header-year">--</span></div>
                        <div class="meta-badge">ğŸ”— <a href="#" id="header-web" target="_blank" style="color:inherit; text-decoration:none;">å®˜ç½‘</a></div>
                    </div>
                </div>
                
                <div style="min-width: 140px;">
                    <button class="btn btn-primary" style="width:100%; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);" onclick="alert('å·²åŠ å…¥ç›‘æ§åˆ—è¡¨')">+ å…³æ³¨ä¼ä¸š</button>
                    <button class="btn btn-outline" style="width:100%; margin-top: 10px; border-color:#cbd5e1;" onclick="alert('éœ€ Enterprise æƒé™')">ğŸ“¥ ä¸‹è½½ç ”æŠ¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. ä¸»è¦å†…å®¹åŒº -->
    <div class="standard-container detail-grid">
        
        <!-- å·¦ä¾§ï¼šä¸»è¦ä¿¡æ¯æµ -->
        <main>
            <!-- A. ä¼ä¸šç®€ä»‹ä¸æ ‡ç­¾ -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-title">ä¼ä¸šæ¦‚å†µ</div>
                </div>
                <p id="company-desc" style="color:#475569; line-height:1.8; font-size:1rem; margin-bottom:20px;">...</p>
                <div class="tag-cloud" id="company-tags"></div>
            </div>

            <!-- B. èèµ„å†ç¨‹ -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-title">èèµ„å†ç¨‹</div>
                    <button class="btn btn-outline" style="padding:4px 10px; font-size:0.8rem;">æŸ¥çœ‹å›¾è¡¨</button>
                </div>
                
                <!-- èèµ„å›¾è¡¨å®¹å™¨ -->
                <div id="funding-chart" style="width: 100%; height: 250px; margin-bottom: 20px; display:none;"></div>

                <div class="table-responsive">
                    <table class="funding-table">
                        <thead>
                            <tr>
                                <th width="15%">æ—¥æœŸ</th>
                                <th width="15%">è½®æ¬¡</th>
                                <th width="20%">é‡‘é¢</th>
                                <th>æŠ•èµ„æ–¹</th>
                            </tr>
                        </thead>
                        <tbody id="funding-list">
                            <tr><td colspan="4" style="text-align:center; padding:20px; color:#94a3b8;">æš‚æ— å…¬å¼€èèµ„æ•°æ®</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- C. æŠ€æœ¯åˆ›æ–°/ä¸“åˆ© (å·²ä¿®æ”¹ï¼šå•è¡Œ+åˆ†é¡µ) -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-title">æŠ€æœ¯ä¸“åˆ©</div>
                </div>
                
                <!-- ä¸“åˆ©åˆ—è¡¨å®¹å™¨ -->
                <div id="patent-list-container" style="min-height: 200px;">
                    <p style="color:#94a3b8; text-align:center; padding:10px;">æ­£åœ¨åŠ è½½ä¸“åˆ©æ•°æ®...</p>
                </div>

                <!-- åˆ†é¡µæ§ä»¶ (é»˜è®¤éšè—ï¼ŒJSæ§åˆ¶æ˜¾ç¤º) -->
                <div id="patent-pagination" class="pagination-controls" style="display:none;">
                    <button class="page-btn" id="btn-prev-patent" onclick="changePatentPage(-1)">ä¸Šä¸€é¡µ</button>
                    <span id="patent-page-info" style="font-size:0.85rem; color:#64748b;">1 / 1</span>
                    <button class="page-btn" id="btn-next-patent" onclick="changePatentPage(1)">ä¸‹ä¸€é¡µ</button>
                </div>

                <!-- åº•éƒ¨é“¾æ¥ï¼šä¿®æ”¹æ–‡æ¡ˆå’Œè·³è½¬ -->
                <div style="text-align:center; margin-top:15px; padding-top:10px; border-top:1px dashed #f1f5f9;">
                    <a href="chart-patents.html" style="font-size:0.9rem; color:#3b82f6; text-decoration:none; display:flex; align-items:center; justify-content:center; gap:5px;">
                        ğŸ” è¿›å…¥ä¸“åˆ©åº“æ£€ç´¢æ›´å¤š
                    </a>
                </div>
            </div>

            <!-- D. äº§å“çŸ©é˜µ -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-title">æ ¸å¿ƒäº§å“</div>
                </div>
                <div class="product-grid" id="product-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </main>

        <!-- å³ä¾§ï¼šæ•°æ®ä»ªè¡¨ç›˜ -->
        <aside>
            <!-- æ ¸å¿ƒæ•°æ®çœ‹æ¿ -->
            <div class="info-card" style="background: linear-gradient(to bottom, #ffffff, #f8fafc);">
                <div class="kv-group">
                    <span class="kv-label">äº§ä¸šé“¾å®šä½</span>
                    <div class="kv-value" id="data-chain">--</div>
                </div>
                <div class="kv-group">
                    <span class="kv-label">ä¸»è¥èµ›é“</span>
                    <div class="kv-value" id="data-category">--</div>
                </div>
                <div class="kv-group">
                    <span class="kv-label">ç´¯è®¡èèµ„ä¼°ç®—</span>
                    <div class="kv-value-lg" id="data-funding">--</div>
                </div>
                <div class="kv-group" style="margin-bottom:0;">
                    <span class="kv-label">èµ„æœ¬çŠ¶æ€</span>
                    <div class="kv-value" id="data-listed">--</div>
                </div>
            </div>

            <!-- ç«å“é›·è¾¾ -->
            <div class="info-card">
                <div class="card-title" style="margin-bottom:15px; font-size:1rem;">ç›¸ä¼¼ä¼ä¸šæ¨è</div>
                <div id="competitor-list">
                    <p style="color:#94a3b8; font-size:0.9rem;">è®¡ç®—ä¸­...</p>
                </div>
            </div>

            <!-- æœ€æ–°åŠ¨æ€ -->
            <div class="info-card">
                <div class="card-title" style="margin-bottom:15px; font-size:1rem;">ç›¸å…³æƒ…æŠ¥</div>
                <div id="intel-feed">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </aside>

    </div>

    <!-- 4. Footer (ä¸¥æ ¼å¤ç”¨ Index æ ·å¼) -->
    <footer>
        <div class="standard-container">
            <div class="footer-grid">
                <div class="footer-col brand-col">
                    <h4 style="font-size:1.2rem;">AeroScope Insight</h4>
                    <p style="font-size:0.9rem; color:#94a3b8; line-height: 1.6; margin-bottom: 20px;">
                        è¿æ¥æ”¿ç­–ã€èµ„æœ¬ä¸æŠ€æœ¯ï¼Œæ‰“é€ ä½ç©ºç»æµé¢†åŸŸçš„æ•°å­—åŒ–åŸºç¡€è®¾æ–½ä¸å†³ç­–å¼•æ“ã€‚
                    </p>
                    <div class="social-icons">
                        <a href="#" class="social-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></a>
                        <a href="#" class="social-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
                        <a href="mailto:contact@aeroscope.cn" class="social-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h4>æ ¸å¿ƒæ¿å—</h4>
                    <ul>
                        <li><a href="news.html">èµ„è®¯å¿«æŠ¥</a></li>
                        <li><a href="policies.html">æ”¿ç­–æ³•è§„</a></li>
                        <li><a href="companies.html">ä¼ä¸šæ•°æ®åº“</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>æ•°æ®å›¾è°±</h4>
                    <ul>
                        <li><a href="chart-funding.html">å…¨çƒèèµ„è¶‹åŠ¿</a></li>
                        <li><a href="chart-cities.html">è¯•ç‚¹åŸå¸‚åˆ†å¸ƒ</a></li>
                        <li><a href="chart-companies.html">äº§ä¸šé“¾å…¨æ™¯å›¾</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>å…³äº</h4>
                    <ul>
                        <li><a href="about.html">å›¢é˜Ÿæ„¿æ™¯</a></li>
                        <li><a href="submit-report.html">å¯»æ±‚æŠ¥é“</a></li>
                        <li><a href="contact.html">å•†åŠ¡åˆä½œ</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright" style="border-top:1px solid #334155; padding-top:20px; margin-top:20px; text-align:center; color:#64748b; font-size:0.85rem;">
                &copy; 2025 AeroScope Insight. All rights reserved. äº¬ICPå¤‡XXXXXXXXå·
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/translations.js"></script>
    <script>
        const supabaseUrl = 'https://ulfktuvatxyakrdrwxfq.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsZmt0dXZhdHh5YWtyZHJ3eGZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NDYyMjksImV4cCI6MjA4MDIyMjIyOX0.SBvHgp9HK_Lr5vXCgwu4Ae-Q6hH4dhMx3JSRbLiU0fU';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // ä¸“åˆ©åˆ†é¡µç›¸å…³å˜é‡
        let allCompanyPatents = []; 
        let currentPatentPage = 1;
        const patentsPerPage = 10;

        document.addEventListener('DOMContentLoaded', async function() {
            checkUserLogin();
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('id');

            if (!companyId) { return; } 

            // 1. è·å–åŸºç¡€ä¿¡æ¯ (Company)
            const { data: company } = await _supabase.from('companies').select('*').eq('id', companyId).single();
            if (company) {
                renderHeader(company);
                renderSidebar(company);
                loadCompetitors(company); 
            } else {
                return; 
            }

            // 2. å¹¶è¡Œè·å–æ·±åº¦æ•°æ® (æ ¸å¿ƒä¿®æ”¹éƒ¨åˆ†ï¼šä½¿ç”¨ bigint ID å…³è”)
            const [fundingRes, patentRes, productRes, newsRes] = await Promise.all([
                // èèµ„ï¼šæŸ¥è¯¢ company_id
                _supabase.from('funding_events')
                    .select('*')
                    .eq('company_id', companyId)
                    .eq('draft', false)
                    .order('funding_date', {ascending: false}),
                
                // ä¸“åˆ©ï¼šã€é‡ç‚¹ã€‘ä½¿ç”¨ related_company_id å…³è”
                _supabase.from('patents')
                    .select('*')
                    .eq('related_company_id', companyId) 
                    .order('publication_date', {ascending: false})
                    .limit(100), 
                
                // äº§å“ï¼šæŸ¥è¯¢ company_id
                _supabase.from('products')
                    .select('*')
                    .eq('company_id', companyId)
                    .eq('draft', false),
                
                // æ–°é—»ï¼šæŸ¥è¯¢æ•°ç»„å­—æ®µ (éœ€è¦ news è¡¨æ”¯æŒ array)
                _supabase.from('news')
                    .select('*')
                    .contains('mentioned_company_ids', [companyId]) // ä½¿ç”¨ array contains æŸ¥è¯¢
                    .limit(5)
            ]);

            renderFunding(fundingRes.data);
            initPatentPagination(patentRes.data);
            renderProducts(productRes.data);
            renderNews(newsRes.data || []); 
        });

        // æ¸²æŸ“å¤´éƒ¨
        function renderHeader(c) {
            document.title = `${c.name} - æ·±åº¦æŠ¥å‘Š | AeroScope`;
            
            const logoEl = document.querySelector('.company-logo-lg');
            if(c.logo_url) logoEl.innerHTML = `<img src="${c.logo_url}" style="width:100%;height:100%;object-fit:cover;">`;
            else logoEl.innerText = (c.name_en || c.name).substring(0,2).toUpperCase();

            document.querySelector('.company-name').innerText = c.name;
            document.getElementById('header-subtitle').innerText = c.name_en || '';
            
            if(c.ticker_symbol) {
                const ticker = document.getElementById('header-ticker');
                ticker.innerText = c.ticker_symbol;
                ticker.style.display = 'inline-block';
            }

            document.getElementById('header-loc').innerText = t(c.location) || 'å…¨çƒ';
            document.getElementById('header-year').innerText = c.founded_year || 'æœªæŠ«éœ²';
            
            const webLink = document.getElementById('header-web');
            if(c.website_url) webLink.href = c.website_url;
            else webLink.parentElement.style.display = 'none';

            document.getElementById('company-desc').innerText = c.description || 'æš‚æ— è¯¦ç»†ä»‹ç»ã€‚';

            if(c.tags && Array.isArray(c.tags)) {
                let tagsHtml = '';
                c.tags.forEach(rawT => tagsHtml += `<span class="tag-pill">#${t(rawT)}</span>`);
                document.getElementById('company-tags').innerHTML = tagsHtml;
            }
        }

        // æ¸²æŸ“èèµ„å†å²
        function renderFunding(events) {
            const tbody = document.getElementById('funding-list');
            if(!events || events.length === 0) return;

            tbody.innerHTML = '';
            let chartDates = [];
            let chartAmounts = [];

            events.forEach(e => {
                let amountStr = 'æœªæŠ«éœ²';
                if(e.funding_amount) {
                    amountStr = `${e.funding_currency || '$'} ${e.funding_amount}M`;
                    chartDates.unshift(e.funding_date);
                    chartAmounts.unshift(e.funding_amount);
                }

                tbody.innerHTML += `
                    <tr>
                        <td style="color:#64748b;">${e.funding_date || '--'}</td>
                        <td><span class="round-tag">${t(e.funding_round)}</span></td>
                        <td style="font-weight:600;">${amountStr}</td>
                        <td><div class="investor-list">${e.participating_investors || e.lead_investor || '-'}</div></td>
                    </tr>
                `;
            });

            if(chartAmounts.length > 0) {
                document.getElementById('funding-chart').style.display = 'block';
                const chart = echarts.init(document.getElementById('funding-chart'));
                chart.setOption({
                    tooltip: { trigger: 'axis' },
                    grid: { top: 20, bottom: 20, left: 40, right: 10 },
                    xAxis: { type: 'category', data: chartDates, show: false },
                    yAxis: { type: 'value', splitLine: { lineStyle: { type: 'dashed' } } },
                    series: [{
                        data: chartAmounts,
                        type: 'bar',
                        itemStyle: { color: '#3b82f6', borderRadius: [4, 4, 0, 0] },
                        barWidth: '40%'
                    }]
                });
            }
        }

        // ä¸“åˆ©åˆ—è¡¨é€»è¾‘
        function initPatentPagination(data) {
            if (!data || data.length === 0) {
                document.getElementById('patent-list-container').innerHTML = '<p style="color:#94a3b8; text-align:center; padding:20px;">æš‚æ— å…¬å¼€ä¸“åˆ©æ•°æ®</p>';
                return;
            }
            allCompanyPatents = data;
            currentPatentPage = 1;
            renderPatentPage();
            document.getElementById('patent-pagination').style.display = 'flex';
        }

        function renderPatentPage() {
            const container = document.getElementById('patent-list-container');
            container.innerHTML = '';

            const start = (currentPatentPage - 1) * patentsPerPage;
            const end = start + patentsPerPage;
            const pageData = allCompanyPatents.slice(start, end);

            pageData.forEach(p => {
                const typeLabel = t(p.patent_type) || 'ä¸“åˆ©';
                
                let statusColor = '#94a3b8';
                let rawStatus = p.legal_status || 'æœªçŸ¥';
                let statusText = t(rawStatus);
                
                if (statusText === 'æœ‰æ•ˆ' || statusText === 'å·²æˆæƒ' || rawStatus === 'Authorized') statusColor = '#16a34a'; 
                else if (statusText.includes('æ— æ•ˆ') || statusText === 'å¤±æ•ˆ' || rawStatus.includes('Terminated')) statusColor = '#ef4444';
                else statusColor = '#f59e0b';
                
                const dateStr = p.publication_date ? p.publication_date.substring(0, 4) : '-';

                container.innerHTML += `
                    <a href="patent-detail.html?id=${p.id}" class="patent-item-link">
                        <div class="patent-item">
                            <div class="patent-icon">IP</div>
                            <div class="patent-content-row">
                                <div class="patent-title" title="${p.title}">${p.title}</div>
                                <div class="patent-meta-inline">
                                    <span class="type-badge">${typeLabel}</span>
                                    <span>${dateStr}</span>
                                    <span style="display:flex; align-items:center; color:${statusColor}; margin-left:5px;">
                                        <span class="status-dot" style="background:${statusColor}"></span>${statusText}
                                    </span>
                                </div>
                            </div>
                            <div style="color:#cbd5e1; font-size:1rem; margin-left:5px;">â€º</div>
                        </div>
                    </a>
                `;
            });
            updatePaginationControls();
        }

        function updatePaginationControls() {
            const totalPages = Math.ceil(allCompanyPatents.length / patentsPerPage);
            document.getElementById('patent-page-info').innerText = `${currentPatentPage} / ${totalPages}`;
            document.getElementById('btn-prev-patent').disabled = currentPatentPage === 1;
            document.getElementById('btn-next-patent').disabled = currentPatentPage === totalPages;
        }

        window.changePatentPage = function(step) {
            const totalPages = Math.ceil(allCompanyPatents.length / patentsPerPage);
            const newPage = currentPatentPage + step;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPatentPage = newPage;
                renderPatentPage();
            }
        };

        // æ¸²æŸ“äº§å“
        function renderProducts(list) {
            const container = document.getElementById('product-list');
            if(!list || list.length === 0) {
                container.innerHTML = '<p style="color:#94a3b8; font-size:0.9rem;">æš‚æ— äº§å“æ•°æ®</p>';
                return;
            }
            container.innerHTML = '';
            list.forEach(p => {
                const img = p.image_url || '';
                container.innerHTML += `
                    <a href="#" class="product-mini-card">
                        <img src="${img}" class="pm-img" onerror="this.style.background='#f1f5f9'">
                        <div class="pm-content">
                            <div class="pm-title">${p.name}</div>
                            <span class="pm-badge">${t(p.type)}</span>
                            <span class="pm-badge" style="color:${p.certification_status==='TC Granted'?'#16a34a':'#f59e0b'}">
                                ${t(p.certification_status) || 'ç ”å‘ä¸­'}
                            </span>
                        </div>
                    </a>
                `;
            });
        }

        // æ¸²æŸ“ä¾§è¾¹æ 
        function renderSidebar(c) {
            const chainEmojis = { 'upstream': 'â›“ï¸ ', 'midstream': 'âœˆï¸ ', 'downstream': 'ğŸ·ï¸ ' };
            const chainText = t(c.industry_chain);
            document.getElementById('data-chain').innerText = (chainEmojis[c.industry_chain] || '') + chainText || '--';
            
            document.getElementById('data-category').innerText = t(c.primary_category) || '--';
            document.getElementById('data-listed').innerText = c.is_listed ? 'å·²ä¸Šå¸‚' : 'æœªä¸Šå¸‚';
            if(c.total_funding_est_usd) document.getElementById('data-funding').innerText = `$${c.total_funding_est_usd}M`;
        }

        // åŠ è½½ç«å“
        async function loadCompetitors(c) {
            if(!c.primary_category) return;
            const { data } = await _supabase.from('companies')
                .select('id, name, logo_url, country_code')
                .eq('primary_category', c.primary_category)
                .neq('id', c.id)
                .limit(5);
            
            const container = document.getElementById('competitor-list');
            if(data && data.length > 0) {
                container.innerHTML = '';
                data.forEach(comp => {
                    const logo = comp.logo_url ? `<img src="${comp.logo_url}" class="comp-logo">` : `<div class="comp-logo" style="display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:bold;">${comp.name.substr(0,1)}</div>`;
                    container.innerHTML += `
                        <a href="company-detail.html?id=${comp.id}" class="comp-item">
                            ${logo}
                            <span class="comp-name">${comp.name}</span>
                            <span class="comp-meta">${comp.country_code}</span>
                        </a>
                    `;
                });
            } else {
                container.innerHTML = '<p style="color:#94a3b8; font-size:0.9rem;">æš‚æ— åŒç±»ç«å“</p>';
            }
        }

        // æ¸²æŸ“æ–°é—» (å ä½ï¼Œå¾…æ–°é—»è¡¨ç»“æ„ç»Ÿä¸€)
        function renderNews(news) {
            const container = document.getElementById('intel-feed');
            if(!news || news.length === 0) { container.innerHTML='<p style="color:#94a3b8; font-size:0.9rem;">æš‚æ— åŠ¨æ€</p>'; return; }
            container.innerHTML = '';
            news.forEach(n => {
                container.innerHTML += `
                    <div style="padding:10px 0; border-bottom:1px solid #f1f5f9;">
                        <a href="news-detail.html?id=${n.id}" style="font-size:0.9rem; font-weight:500; color:#334155; text-decoration:none; display:block; margin-bottom:4px;">${n.title}</a>
                        <div style="font-size:0.75rem; color:#94a3b8;">${n.publish_date || ''}</div>
                    </div>
                `;
            });
        }

        async function checkUserLogin() { const {data:{session}} = await _supabase.auth.getSession(); const btn=document.getElementById('auth-btn'); if(session){btn.innerText=session.user.email.split('@')[0]; btn.onclick=()=>location.href='profile.html';}}
        function toggleMenu() { document.getElementById('navMenu').classList.toggle('active'); }
        
        // å…¨å±€æœç´¢
        let searchTimeout;
        async function performGlobalSearch(keyword) {
            const dropdown = document.getElementById('search-dropdown');
            if (!keyword || keyword.length < 1) { dropdown.style.display = 'none'; return; }
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                dropdown.style.display = 'block';
                const { data } = await _supabase.from('global_search_view').select('*').ilike('title', `%${keyword}%`).limit(5);
                if (!data || !data.length) { dropdown.innerHTML = '<div style="padding:12px; text-align:center;">æ— ç»“æœ</div>'; return; }
                let html = '';
                data.forEach(item => {
                    let link = item.type==='company' ? `company-detail.html?id=${item.id}` : `news-detail.html?id=${item.id}`;
                    html += `<a href="${link}" class="search-result-item">${item.title}</a>`;
                });
                dropdown.innerHTML = html;
            }, 500);
        }
        document.addEventListener('click', (e) => { if(!document.querySelector('.search-component').contains(e.target)) document.getElementById('search-dropdown').style.display='none'; });
    </script>
</body>
</html>
